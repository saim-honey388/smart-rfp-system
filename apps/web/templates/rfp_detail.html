{% extends "base.html" %}
{% block content %}
<section class="page-header">
  <div>
    <h1>{{ rfp.title }}</h1>
    <p class="muted">{{ rfp.description or "No description provided." }}</p>
    <div>
      <span class="badge {{ 'open' if rfp.status == 'open' else 'pending' }}">{{ rfp.status }}</span>
      <span class="muted" style="margin-left: 1rem;">Budget: {{ rfp.budget }} {{ rfp.currency }}</span>
    </div>
  </div>
  <a class="button" href="/rfps/{{ rfp.id }}/comparison">Compare Proposals</a>
</section>

<div class="row" style="display: flex; gap: 2rem; flex-wrap: wrap;">

  <section class="card" style="flex: 2; min-width: 400px; display: flex; flex-direction: column;">
    <h3>Proposals</h3>
    {% if proposals %}
    <div style="max-height: 500px; overflow-y: auto;">
      <table class="table" style="border-collapse: collapse; width: 100%;">
        <thead style="position: sticky; top: 0; background: var(--bg-card); z-index: 1;">
          <tr>
            <th style="border-bottom: 1px solid var(--border-color);">Contractor</th>
            <th style="border-bottom: 1px solid var(--border-color);">Details</th>
            <th style="border-bottom: 1px solid var(--border-color);">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for p in proposals %}
          <tr style="border-bottom: 1px solid var(--border-color);">
            <td style="border-right: none;">
              <strong>{{ p.contractor }}</strong>
              <div class="muted" style="font-size: 0.85rem;">{{ p.price or "Unknown" }} {{ p.currency }}</div>
              <span class="badge {{ p.status }}">
                {{ p.status }}
              </span>
            </td>
            <td style="border-right: none;">
              <p style="margin: 0; font-size: 0.9rem;">
                {{ p.summary or "Summary pending..." }}
              </p>
              <div style="margin-top: 0.5rem;">
                <a href="/proposals/{{ p.id }}/chat" style="font-size: 0.85rem;">Chat with AI &rarr;</a>
              </div>
            </td>
            <td style="border-right: none;">
              {% if p.status == "submitted" or p.status == "reviewed" %}
              <div class="flex-row">
                <button class="button secondary approve-btn" data-proposal-id="{{ p.id }}"
                  style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Approve</button>
                <button class="button danger reject-btn" data-proposal-id="{{ p.id }}"
                  style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Reject</button>
              </div>
              {% elif p.status == "accepted" %}
              <span style="color: var(--color-success); font-weight: bold;">Accepted</span>
              {% elif p.status == "rejected" %}
              <span style="color: var(--color-danger); font-weight: bold;">Rejected</span>
              {% else %}
              <span class="muted">{{ p.status }}</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="muted">No proposals received yet.</p>
    {% endif %}
  </section>

  <section class="card" style="flex: 1; min-width: 300px;">
    <h3>Requirements</h3>
    {% if rfp.requirements %}
    <ul style="padding-left: 1.25rem; color: var(--text-main);">
      {% for req in rfp.requirements %}
      <li style="margin-bottom: 0.5rem;">{{ req.text }}</li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="muted">No explicit requirements.</p>
    {% endif %}
  </section>
</div>

<section class="card">
  <h3>Submit Proposal</h3>
  <form id="create-proposal-form" data-rfp-id="{{ rfp.id }}" enctype="multipart/form-data">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
      <label>Contractor Name <input type="text" name="contractor" required></label>
      <label>Email <input type="email" name="contractor_email" placeholder="contact@company.com"></label>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
      <label>Price <input type="number" step="0.01" name="price"></label>
      <label>Currency <input type="text" name="currency" value="USD"></label>
      <label>Start Date <input type="date" name="start_date"></label>
    </div>

    <label>Upload Benefit: Auto-extract details from PDF
      <input type="file" name="file" accept="application/pdf">
    </label>

    <label>Or manually summarize
      <textarea name="summary" rows="3" placeholder="Proposal summary..."></textarea>
    </label>

    <button type="submit" class="button">Submit Proposal</button>
    <div class="form-status" id="create-proposal-status"></div>
  </form>
</section>
{% endblock %}